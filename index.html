<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0a0f1a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Corporate Actions Tracker</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}html,body,#root{height:100%;width:100%}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#0a0f1a 0%,#1a1f2e 50%,#0d1117 100%);color:#e6edf3;-webkit-font-smoothing:antialiased}
    .loading-screen{position:fixed;inset:0;background:linear-gradient(135deg,#0a0f1a,#1a1f2e,#0d1117);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
    .loading-screen.hidden{display:none}
    .loading-logo{width:80px;height:80px;background:linear-gradient(135deg,#58a6ff,#1f6feb);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:bold;color:white;margin-bottom:24px;animation:pulse 2s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05);opacity:0.8}}
    .event-badge{display:inline-block;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;text-transform:uppercase;min-width:70px;text-align:center;cursor:help}
    .badge-dividend{background:rgba(46,160,67,0.2);color:#3fb950}
    .badge-split{background:rgba(88,166,255,0.2);color:#58a6ff}
    .badge-earnings{background:rgba(187,128,9,0.2);color:#d29922}
    .badge-insider{background:rgba(163,113,247,0.2);color:#a371f7}
    .badge-filing{background:rgba(139,148,158,0.2);color:#8b949e}
    .badge-news{background:rgba(56,139,253,0.2);color:#388bfd}
    .collapsible-header{display:flex;justify-content:space-between;align-items:center;padding:12px;background:rgba(48,54,61,0.3);border:1px solid rgba(48,54,61,0.5);border-radius:8px;cursor:pointer;transition:all 0.2s}
    .collapsible-header:hover{background:rgba(48,54,61,0.5)}
    .collapsible-content{overflow:hidden;transition:max-height 0.3s ease-out}
    .collapsible-content.collapsed{max-height:0}
    .collapsible-content.expanded{max-height:1000px}
    .ticker-valid{border-color:#3fb950 !important}
    .ticker-invalid{border-color:#f85149 !important}
    .ticker-checking{border-color:#d29922 !important}
    .event-row{display:grid;grid-template-columns:100px 1fr 110px 90px 70px;gap:12px;padding:14px 16px;align-items:center;border-bottom:1px solid rgba(48,54,61,0.4)}
    .event-row:last-child{border-bottom:none}
    .event-row-mobile{display:none}
    @media(max-width:700px){
      .event-row{display:none}
      .event-row-mobile{display:block;padding:14px 16px;border-bottom:1px solid rgba(48,54,61,0.4)}
      .search-row{flex-direction:column !important}
      .search-row>*{width:100% !important}
      .date-inputs{display:grid !important;grid-template-columns:1fr 1fr;gap:8px}
    }
    .tab-btn{padding:8px 14px;background:rgba(48,54,61,0.3);border:1px solid transparent;border-radius:6px;color:#8b949e;font-size:12px;cursor:pointer;transition:all 0.2s;white-space:nowrap}
    .tab-btn:hover{background:rgba(48,54,61,0.5)}
    .tab-btn.active{background:rgba(31,111,235,0.2);border-color:rgba(31,111,235,0.5);color:#58a6ff}
    .info-modal{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px}
    .info-modal-content{background:#161b22;border:1px solid rgba(48,54,61,0.8);border-radius:12px;max-width:500px;width:100%;max-height:80vh;overflow-y:auto;padding:20px}
    .lookup-dropdown{position:absolute;top:100%;left:0;right:0;background:#161b22;border:1px solid rgba(48,54,61,0.8);border-radius:8px;max-height:250px;overflow-y:auto;z-index:100;margin-top:4px;box-shadow:0 8px 24px rgba(0,0,0,0.4)}
    .lookup-item{padding:12px 14px;cursor:pointer;border-bottom:1px solid rgba(48,54,61,0.4);display:flex;justify-content:space-between;align-items:center}
    .lookup-item:hover{background:rgba(88,166,255,0.1)}
    .lookup-item:last-child{border-bottom:none}
    .insider-notice{background:rgba(163,113,247,0.1);border:1px solid rgba(163,113,247,0.3);border-radius:8px;padding:12px;margin-bottom:12px;font-size:12px;color:#a371f7}
    .api-status{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .api-status-item{font-size:10px;padding:2px 6px;border-radius:4px}
    .api-ok{background:rgba(46,160,67,0.2);color:#3fb950}
    .api-err{background:rgba(248,81,73,0.2);color:#f85149}
    .api-warn{background:rgba(187,128,9,0.2);color:#d29922}
    .tooltip{position:relative}
    .tooltip:hover::after{content:attr(data-tip);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:#161b22;border:1px solid rgba(48,54,61,0.8);padding:6px 10px;border-radius:6px;font-size:11px;white-space:nowrap;z-index:100;margin-bottom:4px;color:#e6edf3;font-weight:normal;text-transform:none}
  </style>
</head>
<body>
  <div id="root"></div>
  <div class="loading-screen" id="loading"><div class="loading-logo">CA</div></div>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script>
var e=React.createElement,useState=React.useState,useEffect=React.useEffect,useMemo=React.useMemo,useRef=React.useRef;
function fmtC(v,c){if(v===null||v===undefined)return'-';try{return new Intl.NumberFormat('en-US',{style:'currency',currency:c||'USD',minimumFractionDigits:2,maximumFractionDigits:4}).format(v)}catch(e){return'$'+v.toFixed(2)}}
function fmtP(v){return(v>=0?'+':'')+v.toFixed(2)+'%'}
function fmtD(d){if(!d)return'-';return new Date(d).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'})}
function fmtN(v){if(!v)return'0';if(Math.abs(v)>=1e9)return(v/1e9).toFixed(1)+'B';if(Math.abs(v)>=1e6)return(v/1e6).toFixed(1)+'M';if(Math.abs(v)>=1e3)return(v/1e3).toFixed(1)+'K';return v.toLocaleString()}

// CORS proxy for SEC
var CORS_PROXY='https://api.allorigins.win/raw?url=';

// Tooltips for event types
var EVENT_TOOLTIPS={
dividend:'Cash payment to shareholders',
split:'Stock division (e.g. 2:1 = each share becomes 2)',
earnings:'Quarterly financial results report',
insider:'Stock trade by company executive',
secFiling:'Official SEC regulatory filing',
news:'Company news article'
};

function InfoModal(p){
if(!p.show)return null;
return e('div',{className:'info-modal',onClick:p.onClose},
e('div',{className:'info-modal-content',onClick:function(ev){ev.stopPropagation()}},
e('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'16px'}},
e('h3',{style:{margin:0,fontSize:'18px'}},'Corporate Actions'),
e('button',{onClick:p.onClose,style:{background:'none',border:'none',color:'#8b949e',fontSize:'20px',cursor:'pointer'}},'Ã—')
),
e('p',{style:{fontSize:'13px',color:'#8b949e',marginBottom:'16px'}},'Events initiated by public companies that affect shareholders.'),
e('div',{style:{display:'flex',flexDirection:'column',gap:'8px'}},
['ðŸ’° Dividends - Cash payments to shareholders','âœ‚ï¸ Splits - Share division (e.g., 4:1)','ðŸ“Š Earnings - Quarterly EPS reports','ðŸ›ï¸ SEC Filings - 10-K, 10-Q, 8-K','ðŸ‘¤ Insider Trades - Executive transactions'].map(function(t){
return e('div',{key:t,style:{fontSize:'12px',padding:'8px',background:'rgba(48,54,61,0.3)',borderRadius:'6px'}},t)
})
),
e('div',{style:{marginTop:'16px',padding:'12px',background:'rgba(248,81,73,0.1)',border:'1px solid rgba(248,81,73,0.3)',borderRadius:'8px'}},
e('div',{style:{fontSize:'12px',color:'#f85149',fontWeight:'600',marginBottom:'6px'}},'âš ï¸ API Limitations'),
e('div',{style:{fontSize:'11px',color:'#8b949e'}},
'Finnhub free tier no longer includes dividend data. ',
'For full dividend history, consider using a paid API service like Polygon.io or Financial Modeling Prep.'
)
),
e('div',{style:{marginTop:'16px'}},
e('a',{href:'https://www.investopedia.com/terms/c/corporateaction.asp',target:'_blank',style:{color:'#58a6ff',fontSize:'12px'}},'ðŸ“š Learn more â†’')
)
))}

function App(){
var _t=useState(''),ticker=_t[0],setTicker=_t[1];
var _tv=useState(null),tickerValid=_tv[0],setTickerValid=_tv[1];
var _tc=useState(false),tickerChecking=_tc[0],setTickerChecking=_tc[1];
var _tl=useState([]),tickerLookup=_tl[0],setTickerLookup=_tl[1];
var _tlv=useState(false),showLookup=_tlv[0],setShowLookup=_tlv[1];
var _st=useState(''),searchedTicker=_st[0],setSearchedTicker=_st[1];
var _am=useState(10000),investmentAmount=_am[0],setInvestmentAmount=_am[1];
var _sd=useState('2020-01-01'),investmentDate=_sd[0],setInvestmentDate=_sd[1];
var _ed=useState(new Date().toISOString().split('T')[0]),endDate=_ed[0],setEndDate=_ed[1];
var _ld=useState(false),loading=_ld[0],setLoading=_ld[1];
var _er=useState(null),error=_er[0],setError=_er[1];
var _fk=useState(localStorage.getItem('finnhubApiKey')||''),finnhubKey=_fk[0],setFinnhubKey=_fk[1];
var _ss=useState(true),showSetup=_ss[0],setShowSetup=_ss[1];
var _keysOpen=useState(false),keysExpanded=_keysOpen[0],setKeysExpanded=_keysOpen[1];
var _infoOpen=useState(false),showInfo=_infoOpen[0],setShowInfo=_infoOpen[1];
var _hasResults=useState(false),hasResults=_hasResults[0],setHasResults=_hasResults[1];
var _dv=useState([]),dividends=_dv[0],setDividends=_dv[1];
var _sp=useState([]),splits=_sp[0],setSplits=_sp[1];
var _earn=useState([]),earnings=_earn[0],setEarnings=_earn[1];
var _ins=useState([]),insiders=_ins[0],setInsiders=_ins[1];
var _secFil=useState([]),secFilings=_secFil[0],setSecFilings=_secFil[1];
var _pd=useState(null),priceData=_pd[0],setPriceData=_pd[1];
var _dt=useState(null),tickerDetails=_dt[0],setTickerDetails=_dt[1];
var _rt=useState(null),returnCalc=_rt[0],setReturnCalc=_rt[1];
var _tb=useState('all'),activeTab=_tb[0],setActiveTab=_tb[1];
var _cp=useState(null),currentPrice=_cp[0],setCurrentPrice=_cp[1];
var _rc=useState(function(){try{return JSON.parse(localStorage.getItem('recentSearches')||'[]')}catch(e){return[]}}),recentSearches=_rc[0],setRecentSearches=_rc[1];
var _prog=useState(''),progress=_prog[0],setProgress=_prog[1];
var _apiSt=useState({}),apiStatus=_apiSt[0],setApiStatus=_apiSt[1];
var lookupTimeout=useRef(null);

useEffect(function(){
fetch('config.json').then(function(r){return r.json()}).then(function(cfg){
if(cfg.apis&&cfg.apis.finnhub&&cfg.apis.finnhub.key&&!finnhubKey){
setFinnhubKey(cfg.apis.finnhub.key);
localStorage.setItem('finnhubApiKey',cfg.apis.finnhub.key);
}
}).catch(function(){});
},[]);

useEffect(function(){if(finnhubKey)localStorage.setItem('finnhubApiKey',finnhubKey)},[finnhubKey]);
useEffect(function(){document.getElementById('loading').classList.add('hidden')},[]);

function addRecent(t){var u=[t].concat(recentSearches.filter(function(s){return s!==t})).slice(0,8);setRecentSearches(u);localStorage.setItem('recentSearches',JSON.stringify(u))}

function handleTickerInput(val){
var v=val.toUpperCase();
setTicker(v);
setTickerValid(null);
setShowLookup(false);
if(lookupTimeout.current)clearTimeout(lookupTimeout.current);
if(val.length>=2&&finnhubKey){
lookupTimeout.current=setTimeout(function(){
fetch('https://finnhub.io/api/v1/search?q='+encodeURIComponent(val)+'&token='+finnhubKey)
.then(function(r){return r.json()})
.then(function(d){
if(d.result&&d.result.length>0){
var filtered=d.result.filter(function(x){
return (x.type==='Common Stock'||!x.type)&&x.symbol&&x.symbol.indexOf('.')<0;
}).slice(0,8);
setTickerLookup(filtered.map(function(x){return{symbol:x.symbol,name:x.description||x.symbol}}));
if(filtered.length>0)setShowLookup(true);
}
}).catch(function(){});
},300);
}}

function selectLookupTicker(sym){
setTicker(sym);
setTickerValid(true);
setShowLookup(false);
setTickerLookup([]);
}

function validateTicker(){
setShowLookup(false);
if(!ticker){setTickerValid(null);return}
if(tickerValid===true)return;
setTickerChecking(true);
if(finnhubKey){
fetch('https://finnhub.io/api/v1/stock/profile2?symbol='+ticker+'&token='+finnhubKey)
.then(function(r){return r.json()})
.then(function(d){setTickerValid(d&&d.name&&d.name.length>0);setTickerChecking(false)})
.catch(function(){setTickerValid(false);setTickerChecking(false)});
}else{setTickerValid(true);setTickerChecking(false)}}

function calcReturns(prices,divs,splts){
if(!prices||prices.length<2)return;
var stP=prices[0].c,enP=prices[prices.length-1].c;
var stD=new Date(prices[0].t),enD=new Date(prices[prices.length-1].t);
var shares=investmentAmount/stP,adjShares=shares;
var splitEvents=splts.filter(function(s){var d=new Date(s.date);return d>=stD&&d<=enD});
splitEvents.forEach(function(s){var r=(s.toFactor||1)/(s.fromFactor||1);if(r)adjShares=adjShares*r});
var relDivs=divs.filter(function(d){var ex=new Date(d.date);return ex>=stD&&ex<=enD});
var divInc=0;relDivs.forEach(function(d){divInc+=(d.amount||0)*adjShares});
var capitalGain=(enP-stP)*adjShares;
var total=adjShares*enP+divInc;
var pctRet=((total-investmentAmount)/investmentAmount)*100;
var yrs=(enD-stD)/(365.25*24*60*60*1000);
var annRet=yrs>0?(Math.pow(total/investmentAmount,1/yrs)-1)*100:0;
setReturnCalc({startPrice:stP,endPrice:enP,sharesPurchased:shares,adjustedShares:adjShares,capitalGain:capitalGain,totalDividendIncome:divInc,totalReturn:total,percentReturn:pctRet,annualizedReturn:annRet,years:yrs,dividendCount:relDivs.length,splitCount:splitEvents.length})}

function fetchData(){
if(!ticker){setError('Please enter a ticker');return}
if(!finnhubKey){setError('Please enter a Finnhub API key');return}
setLoading(true);setError(null);setProgress('Starting...');setApiStatus({});
var t=ticker.toUpperCase();setSearchedTicker(t);addRecent(t);
var promises=[];
var results={dividends:[],splits:[],earnings:[],insiders:[],secFilings:[],prices:[],details:null,currentPrice:null,cik:null};
var status={};

// FINNHUB API calls
setProgress('Fetching from Finnhub...');

// Earnings Calendar
promises.push(
fetch('https://finnhub.io/api/v1/calendar/earnings?symbol='+t+'&from='+investmentDate+'&to='+endDate+'&token='+finnhubKey)
.then(function(r){return r.json()})
.then(function(d){
console.log('Finnhub earnings:',d);
if(d.earningsCalendar&&d.earningsCalendar.length>0){
results.earnings=d.earningsCalendar.map(function(x){return{type:'earnings',date:x.date,epsActual:x.epsActual,epsEstimate:x.epsEstimate,revenueActual:x.revenueActual,source:'Finnhub',link:'https://finnhub.io/stock/'+t}});
status.earnings='âœ“ '+d.earningsCalendar.length;
}else{status.earnings='0'}
}).catch(function(err){status.earnings='Error: '+err.message;console.error('Earnings error:',err)})
);

// Insider Transactions
promises.push(
fetch('https://finnhub.io/api/v1/stock/insider-transactions?symbol='+t+'&token='+finnhubKey)
.then(function(r){return r.json()})
.then(function(d){
console.log('Finnhub insiders:',d);
if(d.data&&d.data.length>0){
results.insiders=d.data.map(function(x){return{type:'insider',date:x.transactionDate,name:x.name,change:x.change,shares:Math.abs(x.change),transactionPrice:x.transactionPrice,transactionType:x.change>0?'Buy':'Sell',source:'Finnhub',link:'https://www.sec.gov/cgi-bin/browse-edgar?action=getcompany&CIK='+t+'&type=4'}});
status.insiders='âœ“ '+d.data.length;
}else{status.insiders='0'}
}).catch(function(err){status.insiders='Error';console.error('Insiders error:',err)})
);

// Company Profile
promises.push(
fetch('https://finnhub.io/api/v1/stock/profile2?symbol='+t+'&token='+finnhubKey)
.then(function(r){return r.json()})
.then(function(d){
console.log('Finnhub profile:',d);
if(d&&d.name){
results.details={name:d.name,exchange:d.exchange,industry:d.finnhubIndustry,logo:d.logo};
status.profile='âœ“';
}else{status.profile='No data'}
}).catch(function(err){status.profile='Error';console.error('Profile error:',err)})
);

// Quote (current price)
promises.push(
fetch('https://finnhub.io/api/v1/quote?symbol='+t+'&token='+finnhubKey)
.then(function(r){return r.json()})
.then(function(d){
console.log('Finnhub quote:',d);
if(d&&d.c&&d.c>0){results.currentPrice=d.c;status.quote='âœ“ $'+d.c.toFixed(2)}
else{status.quote='No data'}
}).catch(function(err){status.quote='Error';console.error('Quote error:',err)})
);

// Stock Candles (prices)
var fromTs=Math.floor(new Date(investmentDate).getTime()/1000);
var toTs=Math.floor(new Date(endDate).getTime()/1000);
promises.push(
fetch('https://finnhub.io/api/v1/stock/candle?symbol='+t+'&resolution=D&from='+fromTs+'&to='+toTs+'&token='+finnhubKey)
.then(function(r){return r.json()})
.then(function(d){
console.log('Finnhub candles:',d);
if(d&&d.s==='ok'&&d.c&&d.c.length>0){
for(var i=0;i<d.c.length;i++){results.prices.push({c:d.c[i],t:d.t[i]*1000})}
status.prices='âœ“ '+d.c.length+' days';
}else{status.prices='No data (may need paid plan)'}
}).catch(function(err){status.prices='Error';console.error('Candles error:',err)})
);

// Company News 
promises.push(
fetch('https://finnhub.io/api/v1/company-news?symbol='+t+'&from='+investmentDate+'&to='+endDate+'&token='+finnhubKey)
.then(function(r){return r.json()})
.then(function(d){
console.log('Finnhub news:',d);
if(Array.isArray(d)&&d.length>0){
// Only keep recent news (last 50)
var newsItems=d.slice(0,50).map(function(x){
return{type:'news',date:new Date(x.datetime*1000).toISOString().split('T')[0],title:x.headline,summary:x.summary,source:'Finnhub',link:x.url,site:x.source}
});
results.news=newsItems;
status.news='âœ“ '+newsItems.length;
}else{status.news='0'}
}).catch(function(err){status.news='Error';console.error('News error:',err)})
);

// Basic Financials (for dividend yield info)
promises.push(
fetch('https://finnhub.io/api/v1/stock/metric?symbol='+t+'&metric=all&token='+finnhubKey)
.then(function(r){return r.json()})
.then(function(d){
console.log('Finnhub metrics:',d);
if(d&&d.metric){
// Extract dividend info if available
if(d.metric.dividendYieldIndicatedAnnual){
results.dividendYield=d.metric.dividendYieldIndicatedAnnual;
}
if(d.metric.dividendsPerShareAnnual){
results.dividendPerShare=d.metric.dividendsPerShareAnnual;
}
status.metrics='âœ“';
}else{status.metrics='No data'}
}).catch(function(err){status.metrics='Error';console.error('Metrics error:',err)})
);

// SEC EDGAR via CORS proxy
setProgress('Fetching SEC filings...');
promises.push(
fetch(CORS_PROXY+encodeURIComponent('https://www.sec.gov/cgi-bin/browse-edgar?action=getcompany&CIK='+t+'&type=&dateb=&owner=include&count=1&output=atom'))
.then(function(r){return r.text()})
.then(function(xml){
console.log('SEC search result length:',xml.length);
var cikMatch=xml.match(/CIK=(\d+)/);
if(cikMatch){
var cik=cikMatch[1].padStart(10,'0');
results.cik=cik;
return fetch(CORS_PROXY+encodeURIComponent('https://data.sec.gov/submissions/CIK'+cik+'.json'));
}
status.sec='No CIK found';
return null;
})
.then(function(r){return r?r.json():null})
.then(function(d){
console.log('SEC filings:',d?'found':'none');
if(d&&d.filings&&d.filings.recent){
var recent=d.filings.recent;
var secFils=[];
for(var i=0;i<Math.min(recent.form.length,100);i++){
var form=recent.form[i];
var filingDate=recent.filingDate[i];
// Filter by date range
if(filingDate<investmentDate||filingDate>endDate)continue;
if(['10-K','10-Q','8-K','DEF 14A','S-1','4'].indexOf(form)>=0){
var accession=recent.accessionNumber[i].replace(/-/g,'');
var desc=recent.primaryDocDescription?recent.primaryDocDescription[i]:'';
secFils.push({type:'secFiling',date:filingDate,form:form,description:desc||form+' Filing',source:'SEC',link:'https://www.sec.gov/Archives/edgar/data/'+results.cik+'/'+accession});
}}
results.secFilings=secFils;
status.sec='âœ“ '+secFils.length;
if(d.name&&!results.details){results.details={name:d.name}}
}
}).catch(function(err){status.sec='Error (CORS proxy may be down)';console.error('SEC error:',err)})
);

// Note: Dividends require premium Finnhub plan
status.dividends='âš ï¸ Requires premium API';

setProgress('Processing...');
Promise.all(promises).then(function(){
console.log('Final results:',results);
setDividends(results.dividends);
setSplits(results.splits);
setEarnings(results.earnings);
setInsiders(results.insiders);
setSecFilings(results.secFilings);
setTickerDetails(results.details||{name:t});
setCurrentPrice(results.currentPrice);
setApiStatus(status);
if(results.prices.length>0){
setPriceData(results.prices);
calcReturns(results.prices,results.dividends,results.splits);
}else{setPriceData(null);setReturnCalc(null)}
setHasResults(true);setShowSetup(false);setLoading(false);setProgress('');setActiveTab('all');
}).catch(function(err){setError(err.message||'Failed');setLoading(false);setProgress('')})}

useEffect(function(){if(priceData&&dividends&&splits)calcReturns(priceData,dividends,splits)},[investmentAmount]);

var corpActions=useMemo(function(){
var st=new Date(investmentDate),en=new Date(endDate);
var events=[];
function inRange(d){if(!d)return false;var dt=new Date(d);return dt>=st&&dt<=en}
dividends.forEach(function(d){if(inRange(d.date))events.push(d)});
splits.forEach(function(s){if(inRange(s.date))events.push(s)});
earnings.forEach(function(e){if(inRange(e.date))events.push(e)});
secFilings.forEach(function(s){if(inRange(s.date))events.push(s)});
events.sort(function(a,b){return new Date(b.date)-new Date(a.date)});
return events;
},[dividends,splits,earnings,secFilings,investmentDate,endDate]);

var insiderTrades=useMemo(function(){
var st=new Date(investmentDate),en=new Date(endDate);
return insiders.filter(function(i){if(!i.date)return false;var dt=new Date(i.date);return dt>=st&&dt<=en}).sort(function(a,b){return new Date(b.date)-new Date(a.date)});
},[insiders,investmentDate,endDate]);

var filteredEvents=useMemo(function(){
if(activeTab==='all')return corpActions;
if(activeTab==='insider')return insiderTrades;
return corpActions.filter(function(e){return e.type===activeTab});
},[corpActions,insiderTrades,activeTab]);

var eventCounts=useMemo(function(){
var counts={dividend:0,split:0,earnings:0,secFiling:0};
corpActions.forEach(function(ev){if(counts[ev.type]!==undefined)counts[ev.type]++});
return{all:corpActions.length,dividend:counts.dividend,split:counts.split,earnings:counts.earnings,secFiling:counts.secFiling,insider:insiderTrades.length};
},[corpActions,insiderTrades]);

var canSubmit=ticker.length>0&&!tickerChecking&&!loading&&tickerValid!==false&&finnhubKey;

var s={
container:{minHeight:'100vh',background:'linear-gradient(135deg,#0a0f1a,#1a1f2e,#0d1117)',paddingBottom:'20px'},
header:{background:'rgba(13,17,23,0.95)',backdropFilter:'blur(20px)',borderBottom:'1px solid rgba(48,54,61,0.6)',padding:'12px 16px',position:'sticky',top:0,zIndex:100},
card:{background:'rgba(13,17,23,0.6)',border:'1px solid rgba(48,54,61,0.8)',borderRadius:'12px',padding:'16px',marginBottom:'12px'},
input:{width:'100%',padding:'10px 12px',background:'rgba(13,17,23,0.6)',border:'1px solid rgba(48,54,61,0.8)',borderRadius:'8px',color:'#e6edf3',fontSize:'14px',outline:'none',boxSizing:'border-box'},
btn:{padding:'12px 20px',background:'linear-gradient(135deg,#1f6feb,#58a6ff)',border:'none',borderRadius:'8px',color:'#fff',fontSize:'14px',fontWeight:'600',cursor:'pointer'},
label:{display:'block',marginBottom:'4px',fontSize:'11px',color:'#8b949e',fontWeight:'500'},
link:{color:'#58a6ff',textDecoration:'none',fontSize:'11px'}
};

function getEventDetails(ev){
var details={type:'',icon:'',value:'-',description:'',link:ev.link,tooltip:''};
if(ev.type==='dividend'){
details.type='Dividend';details.icon='ðŸ’°';
details.value=fmtC(ev.amount,ev.currency);
details.description='Ex: '+fmtD(ev.date);
if(ev.payDate)details.description+=' â€¢ Pay: '+fmtD(ev.payDate);
details.tooltip=EVENT_TOOLTIPS.dividend;
}else if(ev.type==='split'){
details.type='Split';details.icon='âœ‚ï¸';
details.value=ev.ratio||(ev.toFactor+':'+ev.fromFactor);
details.description='Stock split';
details.tooltip=EVENT_TOOLTIPS.split;
}else if(ev.type==='earnings'){
details.type='Earnings';details.icon='ðŸ“Š';
if(ev.epsActual!==null&&ev.epsActual!==undefined){
details.value='$'+ev.epsActual.toFixed(2)+' EPS';
var beat=ev.epsEstimate&&ev.epsActual>ev.epsEstimate;
details.description='Est: '+(ev.epsEstimate?'$'+ev.epsEstimate.toFixed(2):'N/A')+(beat?' âœ“ Beat':ev.epsEstimate?' âœ— Miss':'');
}else if(ev.epsEstimate){
details.value='Est $'+ev.epsEstimate.toFixed(2);
details.description='Upcoming earnings';
}else{
details.value='Report';
details.description='Earnings release';
}
details.tooltip=EVENT_TOOLTIPS.earnings;
}else if(ev.type==='insider'){
details.type=ev.transactionType||'Trade';
details.icon=ev.change>0?'ðŸŸ¢':'ðŸ”´';
details.value=fmtN(ev.shares)+' shares';
details.description=ev.name+(ev.transactionPrice?' @ $'+ev.transactionPrice.toFixed(2):'');
details.tooltip=EVENT_TOOLTIPS.insider;
}else if(ev.type==='secFiling'){
details.type=ev.form;details.icon='ðŸ›ï¸';
details.value=ev.form;
details.description=ev.description||'SEC Filing';
details.tooltip=EVENT_TOOLTIPS.secFiling;
}else if(ev.type==='news'){
details.type='News';details.icon='ðŸ“°';
details.value=ev.site||'Article';
details.description=ev.title?(ev.title.length>70?ev.title.slice(0,70)+'...':ev.title):'News';
details.tooltip=EVENT_TOOLTIPS.news;
}
return details;
}

function renderEventRow(ev,i){
var d=getEventDetails(ev);
var badgeClass='event-badge badge-'+(ev.type==='secFiling'?'filing':ev.type);
return e('div',{key:i},
e('div',{className:'event-row'},
e('span',{className:badgeClass+' tooltip','data-tip':d.tooltip},d.icon+' '+d.type),
e('div',{style:{fontSize:'12px',color:'#e6edf3',overflow:'hidden',textOverflow:'ellipsis'}},d.description),
e('div',{style:{fontSize:'13px',fontWeight:'600',color:ev.type==='dividend'?'#3fb950':ev.type==='insider'?(ev.change>0?'#3fb950':'#f85149'):'#e6edf3'}},d.value),
e('div',{style:{fontSize:'11px',color:'#8b949e'}},fmtD(ev.date)),
e('div',null,d.link?e('a',{href:d.link,target:'_blank',style:{color:'#58a6ff',fontSize:'11px'}},'View â†’'):e('span',{style:{color:'#6e7681',fontSize:'10px'}},ev.source))
),
e('div',{className:'event-row-mobile'},
e('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'8px'}},
e('span',{className:badgeClass+' tooltip','data-tip':d.tooltip},d.icon+' '+d.type),
e('span',{style:{fontSize:'11px',color:'#8b949e'}},fmtD(ev.date))
),
e('div',{style:{fontSize:'12px',marginBottom:'6px'}},d.description),
e('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
e('span',{style:{fontSize:'14px',fontWeight:'600',color:ev.type==='dividend'?'#3fb950':'#e6edf3'}},d.value),
d.link?e('a',{href:d.link,target:'_blank',style:{color:'#58a6ff',fontSize:'11px'}},'View â†’'):null
)
)
)}

function SearchBar(props){
var isResults=props.isResults;
return e('div',{className:'search-row',style:{display:'flex',gap:'10px',alignItems:'flex-end'}},
e('div',{style:{flex:'1',minWidth:'150px',position:'relative'}},
!isResults&&e('label',{style:s.label},'Stock Ticker'),
e('input',{
type:'text',
value:ticker,
onChange:function(ev){handleTickerInput(ev.target.value)},
onBlur:function(){setTimeout(function(){setShowLookup(false)},200)},
onFocus:function(){if(tickerLookup.length>0)setShowLookup(true)},
onKeyDown:function(ev){if(ev.key==='Enter'&&canSubmit){setShowLookup(false);fetchData()}if(ev.key==='Tab'){validateTicker()}},
placeholder:'Search company or ticker...',
className:tickerChecking?'ticker-checking':tickerValid===true?'ticker-valid':tickerValid===false?'ticker-invalid':'',
style:Object.assign({},s.input,{fontSize:isResults?'14px':'16px',padding:isResults?'10px 12px':'14px'})
}),
showLookup&&tickerLookup.length>0&&e('div',{className:'lookup-dropdown'},
tickerLookup.map(function(item,i){
return e('div',{key:i,className:'lookup-item',onMouseDown:function(ev){ev.preventDefault();ev.stopPropagation();selectLookupTicker(item.symbol)}},
e('div',null,
e('div',{style:{fontWeight:'600',fontSize:'14px',color:'#58a6ff'}},item.symbol),
e('div',{style:{fontSize:'11px',color:'#8b949e',maxWidth:'280px',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}},item.name)
),
e('span',{style:{fontSize:'11px',color:'#3fb950',fontWeight:'500'}},'Select')
)})
),
tickerValid===false&&!tickerChecking&&e('div',{style:{fontSize:'10px',color:'#f85149',marginTop:'4px'}},'Ticker not found')
),
e('div',{className:'date-inputs',style:{display:'flex',gap:'8px'}},
e('input',{type:'date',value:investmentDate,onChange:function(ev){setInvestmentDate(ev.target.value)},style:Object.assign({},s.input,{width:'130px'})}),
e('input',{type:'date',value:endDate,onChange:function(ev){setEndDate(ev.target.value)},style:Object.assign({},s.input,{width:'130px'})})
),
e('button',{onClick:function(){setShowLookup(false);fetchData()},disabled:!canSubmit,style:Object.assign({},s.btn,{opacity:canSubmit?1:0.5,minWidth:'80px'})},loading?(progress||'...'):'Search')
)}

var infoModal=e(InfoModal,{show:showInfo,onClose:function(){setShowInfo(false)}});

// Setup screen
if(showSetup&&!hasResults){
return e('div',{style:s.container},
infoModal,
e('header',{style:s.header},
e('div',{style:{display:'flex',alignItems:'center',justifyContent:'space-between'}},
e('div',{style:{display:'flex',alignItems:'center',gap:'12px'}},
e('div',{style:{width:'36px',height:'36px',background:'linear-gradient(135deg,#58a6ff,#1f6feb)',borderRadius:'10px',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'16px',fontWeight:'bold',color:'white'}},'CA'),
e('h1',{style:{margin:0,fontSize:'18px',fontWeight:'600'}},'Corporate Actions Tracker')
),
e('button',{onClick:function(){setShowInfo(true)},style:{background:'none',border:'1px solid rgba(48,54,61,0.8)',borderRadius:'6px',color:'#8b949e',padding:'6px 10px',fontSize:'12px',cursor:'pointer'}},'â„¹ï¸')
)),
e('main',{style:{padding:'16px'}},
e('div',{style:s.card},
e('h2',{style:{margin:'0 0 16px',fontSize:'16px',fontWeight:'600'}},'Search Corporate Actions'),

// API Key section
e('div',{style:{marginBottom:'16px'}},
e('div',{className:'collapsible-header',onClick:function(){setKeysExpanded(!keysExpanded)}},
e('div',{style:{display:'flex',alignItems:'center',gap:'8px'}},
e('span',null,'ðŸ”‘'),
e('span',{style:{fontSize:'13px',fontWeight:'500'}},'API Key'),
finnhubKey?e('span',{style:{fontSize:'11px',color:'#3fb950',marginLeft:'8px'}},'âœ“ Configured'):e('span',{style:{fontSize:'11px',color:'#f85149',marginLeft:'8px'}},'Required')
),
e('span',{style:{fontSize:'12px',color:'#8b949e'}},keysExpanded?'â–²':'â–¼')
),
e('div',{className:'collapsible-content'+(keysExpanded||!finnhubKey?' expanded':' collapsed')},
e('div',{style:{padding:'12px 0'}},
e('div',{style:{padding:'10px',background:'rgba(48,54,61,0.2)',borderRadius:'6px'}},
e('div',{style:{display:'flex',justifyContent:'space-between',marginBottom:'4px'}},
e('label',{style:s.label},'Finnhub API Key'),
e('span',{style:{fontSize:'9px',color:'#8b949e'}},'60 calls/min')
),
e('input',{type:'password',value:finnhubKey,onChange:function(ev){setFinnhubKey(ev.target.value)},placeholder:'Enter your Finnhub API key',style:s.input}),
e('div',{style:{marginTop:'6px'}},
e('a',{href:'https://finnhub.io/register',target:'_blank',style:s.link},'Get free API key at finnhub.io â†’')
)
),
e('div',{style:{marginTop:'10px',padding:'10px',background:'rgba(187,128,9,0.1)',border:'1px solid rgba(187,128,9,0.3)',borderRadius:'6px',fontSize:'11px',color:'#d29922'}},
'âš ï¸ Note: Finnhub free tier includes earnings, insider trades, news & SEC filings. ',
e('strong',null,'Dividend data requires a paid API.')
)
))
),

// Search inputs
e('div',{style:{display:'flex',flexDirection:'column',gap:'12px'}},
SearchBar({isResults:false}),
recentSearches.length>0&&e('div',{style:{display:'flex',gap:'6px',flexWrap:'wrap'}},
e('span',{style:{fontSize:'11px',color:'#6e7681'}},'Recent:'),
recentSearches.map(function(t){return e('button',{key:t,onClick:function(){setTicker(t);setTickerValid(true)},style:{padding:'4px 10px',background:'rgba(88,166,255,0.1)',border:'1px solid rgba(88,166,255,0.3)',borderRadius:'4px',color:'#58a6ff',fontSize:'11px',cursor:'pointer'}},t)})
),
e('div',null,
e('label',{style:s.label},'Investment Amount (for return calculation)'),
e('input',{type:'number',value:investmentAmount,onChange:function(ev){setInvestmentAmount(parseFloat(ev.target.value)||0)},style:s.input})
)
)),
error&&e('div',{style:{background:'rgba(248,81,73,0.1)',border:'1px solid rgba(248,81,73,0.4)',borderRadius:'8px',padding:'12px',color:'#f85149',fontSize:'13px',marginTop:'12px'}},error),

// Available data types
e('div',{style:{marginTop:'20px',padding:'14px',background:'rgba(48,54,61,0.2)',borderRadius:'8px'}},
e('div',{style:{fontSize:'12px',fontWeight:'600',marginBottom:'10px',color:'#8b949e'}},'ðŸ“Š Available Data (Free Tier)'),
e('div',{style:{display:'flex',flexWrap:'wrap',gap:'6px'}},
[
{icon:'ðŸ“Š',name:'Earnings',ok:true},
{icon:'ðŸ‘¤',name:'Insider Trades',ok:true},
{icon:'ðŸ›ï¸',name:'SEC Filings',ok:true},
{icon:'ðŸ“°',name:'News',ok:true},
{icon:'ðŸ’°',name:'Dividends',ok:false},
{icon:'âœ‚ï¸',name:'Splits',ok:false}
].map(function(t){
return e('span',{key:t.name,style:{padding:'4px 8px',background:t.ok?'rgba(46,160,67,0.1)':'rgba(248,81,73,0.1)',border:'1px solid '+(t.ok?'rgba(46,160,67,0.3)':'rgba(248,81,73,0.3)'),borderRadius:'4px',fontSize:'11px',color:t.ok?'#3fb950':'#f85149'}},t.icon+' '+t.name+(t.ok?'':' (paid)'))
})
)
)
))}

// Results screen
return e('div',{style:s.container},
infoModal,
e('header',{style:s.header},
e('div',{style:{display:'flex',alignItems:'center',gap:'12px',marginBottom:'10px'}},
e('div',{style:{width:'32px',height:'32px',background:'linear-gradient(135deg,#58a6ff,#1f6feb)',borderRadius:'8px',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'14px',fontWeight:'bold',color:'white'}},'CA'),
e('div',{style:{flex:1}},
e('div',{style:{fontSize:'16px',fontWeight:'600'}},searchedTicker),
tickerDetails&&e('div',{style:{fontSize:'11px',color:'#8b949e'}},tickerDetails.name)
),
e('button',{onClick:function(){setShowInfo(true)},style:{background:'none',border:'none',color:'#8b949e',fontSize:'16px',cursor:'pointer'}},'â„¹ï¸')
),
SearchBar({isResults:true})
),
e('main',{style:{padding:'12px'}},
// API Status
Object.keys(apiStatus).length>0&&e('div',{className:'api-status',style:{marginBottom:'10px'}},
Object.keys(apiStatus).map(function(k){
var isOk=apiStatus[k].startsWith('âœ“');
var isWarn=apiStatus[k].startsWith('âš ï¸');
return e('span',{key:k,className:'api-status-item '+(isOk?'api-ok':isWarn?'api-warn':'api-err')},k+': '+apiStatus[k])
})
),
// Price card
currentPrice&&e('div',{style:Object.assign({},s.card,{background:'linear-gradient(135deg,rgba(31,111,235,0.1),rgba(88,166,255,0.05))'})},
e('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
e('div',null,
e('div',{style:{fontSize:'24px',fontWeight:'700'}},fmtC(currentPrice)),
e('div',{style:{fontSize:'11px',color:'#8b949e'}},'Current Price')
),
returnCalc&&e('div',{style:{textAlign:'right'}},
e('div',{style:{fontSize:'24px',fontWeight:'700',color:returnCalc.percentReturn>=0?'#3fb950':'#f85149'}},fmtP(returnCalc.percentReturn)),
e('div',{style:{fontSize:'11px',color:'#8b949e'}},returnCalc.annualizedReturn.toFixed(1)+'% annualized')
)
),
returnCalc&&e('div',{style:{marginTop:'12px',background:'rgba(0,0,0,0.2)',borderRadius:'8px',padding:'12px'}},
e('div',{style:{display:'grid',gridTemplateColumns:'1fr auto',gap:'6px',fontSize:'12px'}},
e('div',null,'Invested:'),e('div',{style:{textAlign:'right'}},fmtC(investmentAmount)),
e('div',null,'Shares @ '+fmtC(returnCalc.startPrice)+':'),e('div',{style:{textAlign:'right'}},returnCalc.sharesPurchased.toFixed(4)),
e('div',null,'Price gain:'),e('div',{style:{textAlign:'right',color:returnCalc.capitalGain>=0?'#3fb950':'#f85149'}},fmtC(returnCalc.capitalGain)),
e('div',{style:{borderTop:'1px solid rgba(48,54,61,0.5)',paddingTop:'6px',fontWeight:'600'}},'Final Value:'),
e('div',{style:{textAlign:'right',borderTop:'1px solid rgba(48,54,61,0.5)',paddingTop:'6px',fontWeight:'600',color:returnCalc.percentReturn>=0?'#3fb950':'#f85149'}},fmtC(returnCalc.totalReturn))
)
)
),
// Event summary
e('div',{style:{fontSize:'12px',color:'#8b949e',marginBottom:'10px',display:'flex',justifyContent:'space-between'}},
e('span',null,e('strong',null,eventCounts.all),' corporate events',eventCounts.insider>0&&e('span',null,' + ',e('strong',null,eventCounts.insider),' insider trades')),
e('a',{href:'https://www.investopedia.com/terms/c/corporateaction.asp',target:'_blank',style:{color:'#58a6ff',fontSize:'11px'}},'Learn â†’')
),
// Tabs
e('div',{style:{display:'flex',gap:'6px',marginBottom:'12px',overflowX:'auto',paddingBottom:'4px'}},
[
{key:'all',label:'All ('+eventCounts.all+')'},
{key:'earnings',label:'ðŸ“Š Earnings ('+eventCounts.earnings+')'},
{key:'secFiling',label:'ðŸ›ï¸ SEC ('+eventCounts.secFiling+')'},
{key:'insider',label:'ðŸ‘¤ Insider ('+eventCounts.insider+')'}
].filter(function(t){return eventCounts[t.key]>0||t.key==='all'}).map(function(tab){
return e('button',{key:tab.key,className:'tab-btn'+(activeTab===tab.key?' active':''),onClick:function(){setActiveTab(tab.key)}},tab.label)
})),
activeTab==='insider'&&e('div',{className:'insider-notice'},'ðŸ‘¤ Stock transactions by company executives. Shown separately due to volume.'),
// Event table
e('div',{style:Object.assign({},s.card,{padding:0,overflow:'hidden'})},
e('div',{className:'event-row',style:{background:'rgba(48,54,61,0.3)',fontWeight:'600',fontSize:'11px',color:'#8b949e'}},
e('span',null,'TYPE'),e('span',null,'DETAILS'),e('span',null,'VALUE/TYPE'),e('span',null,'DATE'),e('span',null,'')
),
filteredEvents.length===0?
e('div',{style:{padding:'40px',textAlign:'center',color:'#8b949e'}},
activeTab==='all'?'No corporate events found for this period. Note: dividend data requires a paid API.':'No '+activeTab+' events found'
):
e('div',{style:{maxHeight:'500px',overflowY:'auto'}},filteredEvents.slice(0,100).map(renderEventRow))
),
filteredEvents.length>100&&e('div',{style:{fontSize:'11px',color:'#8b949e',textAlign:'center',marginTop:'8px'}},'Showing first 100 of '+filteredEvents.length+' events'),
e('div',{style:{marginTop:'16px',fontSize:'10px',color:'#6e7681',textAlign:'center'}},'Data: Finnhub â€¢ SEC EDGAR')
))}
ReactDOM.createRoot(document.getElementById('root')).render(e(App));
  </script>
</body>
</html>
